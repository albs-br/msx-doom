Main.s1FNAME "msx-doom.rom" 3PageSize: equ 0x4000 4Seg_P8000_SW: equ 0x7000 6910 org 0x4000, 0xbeff 12 Include/RomHeader.s12 db "AB" 3 dw Execute 4 dw 0 6 dw 0 8 dw 0 9 dw 0, 0, 0 10 11Main.s13 Include/MsxBios.s189BIOS_HWVER: equ 0x002d1112BIOS_CGTABL: equ 0x0004 13BIOS_VDP_DR: equ 0x0006 14BIOS_VDP_DW: equ 0x0007 1617BIOS_CHKRAM: equ 0x000018BIOS_SYNCHR: equ 0x000819BIOS_RDSLT: equ 0x000c20BIOS_CHRGTR: equ 0x001021BIOS_WRSLT: equ 0x001422BIOS_OUTDO: equ 0x001823BIOS_CALSLT: equ 0x001c24BIOS_DCOMPR: equ 0x002025BIOS_ENASLT: equ 0x002426BIOS_GETYPR: equ 0x002827BIOS_CALLF: equ 0x003028BIOS_KEYINT: equ 0x00383031BIOS_INITIO: equ 0x003b32BIOS_INIFNK: equ 0x003e3435BIOS_DISSCR: equ 0x004136BIOS_ENASCR: equ 0x004437BIOS_WRTVDP: equ 0x004738BIOS_RDVRM: equ 0x004a39BIOS_WRTVRM: equ 0x004d40BIOS_SETRD: equ 0x005041BIOS_SETWRT: equ 0x005342BIOS_FILVRM: equ 0x005643BIOS_LDIRMV: equ 0x005944BIOS_LDIRVM: equ 0x005c45BIOS_CHGMOD: equ 0x005f46BIOS_CHGCLR: equ 0x006247BIOS_NMI: equ 0x006648BIOS_CLRSPR: equ 0x006949BIOS_INITXT: equ 0x006c50BIOS_INIT32: equ 0x006f51BIOS_INIGRP: equ 0x007252BIOS_INIMLT: equ 0x007553BIOS_SETTXT: equ 0x007854BIOS_SETT32: equ 0x007b55BIOS_SETGRP: equ 0x007e56BIOS_SETMLT: equ 0x008157BIOS_CALPAT: equ 0x008458BIOS_CALATR: equ 0x008759BIOS_GSPSIZ: equ 0x008a60BIOS_GRPPRT: equ 0x008d6263BIOS_GICINI: equ 0x009064BIOS_WRTPSG: equ 0x009365BIOS_RDPSG: equ 0x009666BIOS_STRTMS: equ 0x00996869BIOS_CHSNS: equ 0x009c70BIOS_CHGET: equ 0x009f71BIOS_CHPUT: equ 0x00a272BIOS_LPTOUT: equ 0x00a573BIOS_LPTSTT: equ 0x00a874BIOS_CNVCHR: equ 0x00ab75BIOS_PINLIN: equ 0x00ae76BIOS_INLIN: equ 0x00b177BIOS_QINLIN: equ 0x00b478BIOS_BREAKX: equ 0x00b779BIOS_BEEP: equ 0x00c080BIOS_CLS: equ 0x00c381BIOS_POSIT: equ 0x00c682BIOS_FNKSB: equ 0x00c983BIOS_ERAFNK: equ 0x00cc84BIOS_DSPFNK: equ 0x00cf85BIOS_TOTEXT: equ 0x00d28788BIOS_GTSTCK: equ 0x00d589BIOS_GTTRIG: equ 0x00d890BIOS_GTPAD: equ 0x00db91BIOS_GTPDL: equ 0x00de9394BIOS_TAPION: equ 0x00e195BIOS_TAPIN: equ 0x00e496BIOS_TAPIOF: equ 0x00e797BIOS_TAPOON: equ 0x00ea98BIOS_TAPOUT: equ 0x00ed99BIOS_TAPOOF: equ 0x00f0100BIOS_STMOTR: equ 0x00f3102103BIOS_CHGCAP: equ 0x0132104BIOS_CHGSND: equ 0x0135105BIOS_RSLREG: equ 0x0138106BIOS_WSLREG: equ 0x013b107BIOS_RDVDP: equ 0x013e108BIOS_SNSMAT: equ 0x0141109BIOS_PHYDIO: equ 0x0144110BIOS_ISFLIO: equ 0x014a111BIOS_OUTDLP: equ 0x014d112BIOS_KILBUF: equ 0x0156113BIOS_CALBAS: equ 0x0159115116BIOS_SUBROM: equ 0x015c117BIOS_EXTROM: equ 0x015f118BIOS_EOL: equ 0x0168119BIOS_BIGFIL: equ 0x016b120BIOS_NSETRD: equ 0x016e121BIOS_NSTWRT: equ 0x0171122BIOS_NRDVRM: equ 0x0174123BIOS_NWRVRM: equ 0x0177125126BIOS_GRPRT: equ 0x0089127BIOS_NVBXLN: equ 0x00c9128BIOS_NVBXFL: equ 0x00cd129BIOS_CLSSUB: equ 0x0115130BIOS_VDPSTA: equ 0x0131131BIOS_SETPAG: equ 0x013d132BIOS_INIPLT: equ 0x0141133BIOS_RSTPLT: equ 0x0145134BIOS_GETPLT: equ 0x0149135BIOS_SETPLT: equ 0x014d136BIOS_PROMPT: equ 0x0181137BIOS_NEWPAD: equ 0x01ad138BIOS_CHGMDP: equ 0x01b5139BIOS_KNJPRT: equ 0x01bd140BIOS_REDCLK: equ 0x01f5141BIOS_WRTCLK: equ 0x01f9143144BIOS_RDPRIM: equ 0xf380145BIOS_WRPRIM: equ 0xf385146BIOS_CLPRIM: equ 0xf38c148149BIOS_USRTAB: equ 0xf39a150BIOS_LINL40: equ 0xf3ae151BIOS_LINL32: equ 0xf3af152BIOS_LINLEN: equ 0xf3b0153BIOS_CRTCNT: equ 0xf3b1154BIOS_CLMLST: equ 0xf3b2156157BIOS_TXTNAM: equ 0xf3b3158BIOS_TXTCOL: equ 0xf3b5159BIOS_TXTCGP: equ 0xf3b7160BIOS_TXTATR: equ 0xf3b9161BIOS_TXTPAT: equ 0xf3bb163164BIOS_T32NAM: equ 0xf3bd165BIOS_T32COL: equ 0xf3bf166BIOS_T32CGP: equ 0xf3c1167BIOS_T32ATR: equ 0xf3c3168BIOS_T32PAT: equ 0xf3c5170171BIOS_GRPNAM: equ 0xf3c7172BIOS_GRPCOL: equ 0xf3c9173BIOS_GRPCGP: equ 0xf3cb174BIOS_GRPATR: equ 0xf3cd175BIOS_GRPPAT: equ 0xf3cf177178BIOS_MLTNAM: equ 0xf3d1179BIOS_MLTCOL: equ 0xf3d3180BIOS_MLTCGP: equ 0xf3d5181BIOS_MLTATR: equ 0xf3d7182BIOS_MLTPAT: equ 0xf3d9184185BIOS_CLIKSW: equ 0xf3db186BIOS_CSRY: equ 0xf3dc187BIOS_CSRX: equ 0xf3dd188BIOS_CNSDFG: equ 0xf3de190191BIOS_RG0SAV: equ 0xf3df192BIOS_RG1SAV: equ 0xf3e0193BIOS_RG2SAV: equ 0xf3e1194BIOS_RG3SAV: equ 0xf3e2195BIOS_RG4SAV: equ 0xf3e3196BIOS_RG5SAV: equ 0xf3e4197BIOS_RG6SAV: equ 0xf3e5198BIOS_RG7SAV: equ 0xf3e6199BIOS_RG8SAV: equ 0xffe7200BIOS_RG9SAV: equ 0xffe8201BIOS_STATFL: equ 0xf3e7202BIOS_TRGFLG: equ 0xf3e8203BIOS_FORCLR: equ 0xf3e9204BIOS_BAKCLR: equ 0xf3ea205BIOS_BDRCLR: equ 0xf3eb206BIOS_MAXUPD: equ 0xf3ec207BIOS_MINUPD: equ 0xf3ef208BIOS_ATRBYT: equ 0xf3f2210211BIOS_QUEUES: equ 0xf3f3212BIOS_FRCNEW: equ 0xf3f5214215BIOS_SCNCNT: equ 0xf3f6216BIOS_REPCNT: equ 0xf3f7217BIOS_PUTPNT: equ 0xf3f8218BIOS_GETPNT: equ 0xf3fa220221BIOS_CS120: equ 0xf3fc222BIOS_LOW: equ 0xf406223BIOS_HIGH: equ 0xf408224BIOS_HEADER: equ 0xf40a225BIOS_ASPCT1: equ 0xf40b226BIOS_ASPCT2: equ 0xf40d227BIOS_ENDPRG: equ 0xf40f229230BIOS_ERRFLG: equ 0xf414231BIOS_LPTPOS: equ 0xf415232BIOS_PRTFLG: equ 0xf416233BIOS_NTMSXP: equ 0xf417234BIOS_RAWPRT: equ 0xf418235BIOS_VLZADR: equ 0xf419236BIOS_VLZDAT: equ 0xf41b237BIOS_CURLIN: equ 0xf41c238BIOS_KBUF: equ 0xf41f239BIOS_BUFMIN: equ 0xf55d240BIOS_BUF: equ 0xf55e241BIOS_ENDBUF: equ 0xf660242BIOS_TTYPOS: equ 0xf661243BIOS_DIMFLG: equ 0xf662244BIOS_VALTYP: equ 0xf663245BIOS_DORES: equ 0xf664246BIOS_DONUM: equ 0xf665247BIOS_CONTXT: equ 0xf666248BIOS_CONSAV: equ 0xf668249BIOS_CONTYP: equ 0xf669250BIOS_CONLO: equ 0xf66a251BIOS_MEMSIZ: equ 0xf672252BIOS_STKTOP: equ 0xf674253BIOS_TXTTAB: equ 0xf676254BIOS_TEMPPT: equ 0xf768255BIOS_TEMPST: equ 0xf67a256BIOS_DSCTMP: equ 0xf698257BIOS_FRETOP: equ 0xf69b258BIOS_TEMP3: equ 0xf69d259BIOS_TEMP8: equ 0xf69f260BIOS_ENDFOR: equ 0xf6a1261BIOS_SUBFLG: equ 0xf6a5262BIOS_FLGINP: equ 0xf6a6263BIOS_TEMP: equ 0xf6a7264BIOS_PTRFLG: equ 0xf6a9265BIOS_AUTFLG: equ 0xf6aa266BIOS_AUTLIN: equ 0xf6ab267BIOS_AUTINC: equ 0xf6ad268BIOS_SAVTXT: equ 0xf6af269BIOS_ERRLIN: equ 0xf6b3270BIOS_DOT: equ 0xf6b5271BIOS_ERRTXT: equ 0xf6b7272BIOS_ONELIN: equ 0xf6b9273BIOS_ONEFLG: equ 0xf6bb274BIOS_TEMP2: equ 0xf6bc275BIOS_OLDLIN: equ 0xf6be276BIOS_OLDTXT: equ 0xf6c0277BIOS_VARTAB: equ 0xf6c2278BIOS_ARYTAB: equ 0xf6c4279BIOS_STREND: equ 0xf6c6280BIOS_DATPTR: equ 0xf6c8281BIOS_DEFTBL: equ 0xf6ca282BIOS_PRMSTK: equ 0xf6e4283BIOS_PRMLEN: equ 0xf6e6284BIOS_PARM1: equ 0xf6e8285BIOS_PRMPRV: equ 0xf74c286BIOS_PRMLN2: equ 0xf74e287BIOS_PARM2: equ 0xf750288BIOS_PRMFLG: equ 0xf7b4289BIOS_ARYTA2: equ 0xf7b5290BIOS_NOFUNS: equ 0xf7b7291BIOS_TEMP9: equ 0xf7b8292BIOS_FUNACT: equ 0xf7ba293BIOS_SWPTMP: equ 0xf7bc294BIOS_TRCFLG: equ 0xf7c4296297BIOS_FBUFFR: equ 0xf7c5298BIOS_DECTMP: equ 0xf7f0299BIOS_DECTM2: equ 0xf7f2300BIOS_DECCNT: equ 0xf7f4301BIOS_DAC: equ 0xf7f6302BIOS_HOLD8: equ 0xf806303BIOS_HOLD2: equ 0xf836304BIOS_HOLD: equ 0xf83e305BIOS_ARG: equ 0xf847306BIOS_RNDX: equ 0xf857308309BIOS_USRDATA: equ 0xf7f8311312BIOS_MAXFIL: equ 0xf85f313BIOS_FILTAB: equ 0xf860314BIOS_NULBUF: equ 0xf862315BIOS_PTRFIL: equ 0xf864316BIOS_RUNFLG: equ 0xf866317BIOS_FILNAM: equ 0xf866318BIOS_FILNM2: equ 0xf871319BIOS_NLONLY: equ 0xf87c320BIOS_SAVEND: equ 0xf87d321BIOS_FNKSTR: equ 0xf87f322BIOS_CGPNT: equ 0xf91f323BIOS_NAMBAS: equ 0xf922324BIOS_CGPBAS: equ 0xf924325BIOS_PATBAS: equ 0xf926326BIOS_ATRBAS: equ 0xf928327BIOS_CLOC: equ 0xf92a328BIOS_CMASK: equ 0xf92c329BIOS_MINDEL: equ 0xf92d330BIOS_MAXDEL: equ 0xf92f332333BIOS_ASPECT: equ 0xf931334BIOS_CENCNT: equ 0xf933335BIOS_CLINEF: equ 0xf935336BIOS_CNPNTS: equ 0xf936337BIOS_CPLOTF: equ 0xf938338BIOS_CPCNT: equ 0xf939339BIOS_CPNCNT8: equ 0xf93b340BIOS_CPCSUM: equ 0xf93d341BIOS_CSTCNT: equ 0xf93f342BIOS_CSCLXY: equ 0xf941343BIOS_CSAVEA: equ 0xf942344BIOS_CSAVEM: equ 0xf944345BIOS_CXOFF: equ 0xf945346BIOS_CYOFF: equ 0xf947348349BIOS_LOHMSK: equ 0xf949350BIOS_LOHDIR: equ 0xf94a351BIOS_LOHADR: equ 0xf94b352BIOS_LOHCNT: equ 0xf94d353BIOS_SKPCNT: equ 0xf94f354BIOS_MIVCNT: equ 0xf951355BIOS_PDIREC: equ 0xf953356BIOS_LFPROG: equ 0xf954357BIOS_RTPROG: equ 0xf955359360BIOS_MCLTAB: equ 0xf956361BIOS_MCLFLG: equ 0xf958362BIOS_QUETAB: equ 0xf959363BIOS_QUEBAK: equ 0xf971364BIOS_VOICAQ: equ 0xf975365BIOS_VOICBQ: equ 0xf9f5366BIOS_VOICCQ: equ 0xfa75368369BIOS_DPPAGE: equ 0xfaf5370BIOS_ACPAGE: equ 0xfaf6371BIOS_AVCSAV: equ 0xfaf7372BIOS_EXBRSA: equ 0xfaf8373BIOS_CHRCNT: equ 0xfaf9374BIOS_ROMA: equ 0xfafa375BIOS_MODE: equ 0xfafc376BIOS_NORUSE: equ 0xfafd377BIOS_XSAVE: equ 0xfafe378BIOS_YSAVE: equ 0xfb00379BIOS_LOGOPR: equ 0xfb02381382BIOS_RSTMP: equ 0xfb03383BIOS_TOCNT: equ 0xfb03384BIOS_RSFCB: equ 0xfb04385BIOS_RSIQLN: equ 0xfb06386BIOS_MEXBIH: equ 0xfb07387BIOS_OLDSTT: equ 0xfb0c388BIOS_OLDINT: equ 0xfb12389BIOS_DEVNUM: equ 0xfb17390BIOS_DATCNT: equ 0xfb18391BIOS_ERRORS: equ 0xfb1b392BIOS_FLAGS: equ 0xfb1c393BIOS_ESTBLS: equ 0xfb1d394BIOS_COMMSK: equ 0xfb1e395BIOS_LSTCOM: equ 0xfb1f396BIOS_LSTMOD: equ 0xfb20398399BIOS_PRSCNT: equ 0xfb35400BIOS_SAVSP: equ 0xfb36401BIOS_VOICEN: equ 0xfb38402BIOS_SAVVOL: equ 0xfb39403BIOS_MCLLEN: equ 0xfb3b404BIOS_MCLPTR: equ 0xfb3c405BIOS_QUEUEN: equ 0xfb3e406BIOS_MUSICF: equ 0xfc3f407BIOS_PLYCNT: equ 0xfb40409410BIOS_VCBA: equ 0xfb41411BIOS_VCBB: equ 0xfb66412BIOS_VCBC: equ 0xfb8b414415BIOS_ENSTOP: equ 0xfbb0416BIOS_BASROM: equ 0xfbb1417BIOS_LINTTB: equ 0xfbb2418BIOS_FSTPOS: equ 0xfbca419BIOS_CODSAV: equ 0xfbcc420BIOS_FNKSW1: equ 0xfbcd421BIOS_FNKFLG: equ 0xfbce422BIOS_ONGSBF: equ 0xfbd8423BIOS_CLIKFL: equ 0xfbd9424BIOS_OLDKEY: equ 0xfbda425BIOS_NEWKEY: equ 0xfbe5426BIOS_KEYBUF: equ 0xfbf0427BIOS_LINWRK: equ 0xfc18428BIOS_PATWRK: equ 0xfc40429BIOS_BOTTOM: equ 0xfc48430BIOS_HIMEM: equ 0xfc4a431BIOS_TRAPTBL: equ 0xfc4c432BIOS_RTYCNT: equ 0xfc9a433BIOS_INTFLG: equ 0xfc9b434BIOS_PADY: equ 0xfc9c435BIOS_PADX: equ 0xfc9d436BIOS_JIFFY: equ 0xfc9e437BIOS_INTVAL: equ 0xfca0438BIOS_INTCNT: equ 0xfca2439BIOS_LOWLIM: equ 0xfca4440BIOS_WINWID: equ 0xfca5441BIOS_GRPHED: equ 0xfca6442BIOS_ESCCNT: equ 0xfca7443BIOS_INSFLG: equ 0xfca8444BIOS_CSRSW: equ 0xfca9445BIOS_CSTYLE: equ 0xfcaa446BIOS_CAPST: equ 0xfcab447BIOS_KANAST: equ 0xfcac448BIOS_KANAMD: equ 0xfcad449BIOS_FLBMEM: equ 0xfcae450BIOS_SCRMOD: equ 0xfcaf451BIOS_OLDSCR: equ 0xfcb0452BIOS_CASPRV: equ 0xfcb1453BIOS_BRDATR: equ 0xfcb2454BIOS_GXPOS: equ 0xfcb3455BIOS_GYPOS: equ 0xfcb5456BIOS_GRPACX: equ 0xfcb7457BIOS_GRPACY: equ 0xfcb9458BIOS_DRWFLG: equ 0xfcbb459BIOS_DRWSCL: equ 0xfcbc460BIOS_DRWANG: equ 0xfcbd461BIOS_RUNBNF: equ 0xfcbe462BIOS_SAVENT: equ 0xfcbf463BIOS_ROMSLT: equ 0xfcc0464BIOS_EXPTBL: equ 0xfcc1465BIOS_SLTTBL: equ 0xfcc5466BIOS_SLTATR: equ 0xfcc9467BIOS_SLTWRK: equ 0xfd09468BIOS_PROCNM: equ 0xfd89469BIOS_DEVICE: equ 0xfd99471472BIOS_H_KEYI: equ 0xfd9a473BIOS_H_TIMI: equ 0xfd9f474BIOS_H_CHPH: equ 0xfda4475BIOS_H_DSPC: equ 0xfda9476BIOS_H_ERAC: equ 0xfdae477BIOS_H_DSPF: equ 0xfdb3478BIOS_H_ERAF: equ 0xfdb8479BIOS_H_TOTE: equ 0xfdbd480BIOS_H_CHGE: equ 0xfdc2481BIOS_H_INIP: equ 0xfdc7482BIOS_H_KEYC: equ 0xfdcc483BIOS_H_KYEA: equ 0xfdd1484BIOS_H_NMI: equ 0xfdd6485BIOS_H_PINL: equ 0xfddb486BIOS_H_QINL: equ 0xfde0487BIOS_H_INLI: equ 0xfde5488BIOS_H_ONGO: equ 0xfdea489BIOS_H_DSKO: equ 0xfdef490BIOS_H_SETS: equ 0xfdf4491BIOS_H_NAME: equ 0xfdf9492BIOS_H_KILL: equ 0xfdfe493BIOS_H_IPL: equ 0xfe03494BIOS_H_COPY: equ 0xfe08495BIOS_H_CMD: equ 0xfe0d496BIOS_H_DSKF: equ 0xfe12497BIOS_H_DSKI: equ 0xfe17498BIOS_H_ATTR: equ 0xfe1c499BIOS_H_LSET: equ 0xfe21500BIOS_H_RSET: equ 0xfe26501BIOS_H_FIEL: equ 0xfe2b502BIOS_H_MKI: equ 0xfe30503BIOS_H_MKS: equ 0xfe35504BIOS_H_MKD: equ 0xfe3a505BIOS_H_CVI: equ 0xfe3f506BIOS_H_CVS: equ 0xfe44507BIOS_H_CVD: equ 0xfe49508BIOS_H_GETP: equ 0xfe4e509BIOS_H_SETF: equ 0xfe53510BIOS_H_NOFO: equ 0xfe58511BIOS_H_NULO: equ 0xfe5d512BIOS_H_NTFL: equ 0xfe62513BIOS_H_MERG: equ 0xfe67514BIOS_H_SAVE: equ 0xfe6c515BIOS_H_BINS: equ 0xfe71516BIOS_H_BINL: equ 0xfe76517BIOS_H_FILE: equ 0xfd7b518BIOS_H_DGET: equ 0xfe80519BIOS_H_FILO: equ 0xfe85520BIOS_H_INDS: equ 0xfe8a521BIOS_H_RSLF: equ 0xfe8f522BIOS_H_SAVD: equ 0xfe94523BIOS_H_LOC: equ 0xfe99524BIOS_H_LOF: equ 0xfe9e525BIOS_H_EOF: equ 0xfea3526BIOS_H_FPOS: equ 0xfea8527BIOS_H_BAKU: equ 0xfead528BIOS_H_PARD: equ 0xfeb2529BIOS_H_NODE: equ 0xfeb7530BIOS_H_POSD: equ 0xfebc531BIOS_H_DEVN: equ 0xfec1532BIOS_H_GEND: equ 0xfec6533BIOS_H_RUNC: equ 0xfecb534BIOS_H_CLEAR: equ 0xfed0535BIOS_H_LOPD: equ 0xfed5536BIOS_H_STKE: equ 0xfeda537BIOS_H_ISFL: equ 0xfedf538BIOS_H_OUTD: equ 0xfee4539BIOS_H_CRDO: equ 0xfee9540BIOS_H_DSKC: equ 0xfeee541BIOS_H_DOGR: equ 0xfef3542BIOS_H_PRGE: equ 0xfef8543BIOS_H_ERRP: equ 0xfefd544BIOS_H_ERRF: equ 0xff02545BIOS_H_READ: equ 0xff07546BIOS_H_MAIN: equ 0xff0c547BIOS_H_DIRD: equ 0xff11548BIOS_H_FINI: equ 0xff16549BIOS_H_FINE: equ 0xff1b550BIOS_H_CRUN: equ 0xff20551BIOS_H_CRUS: equ 0xff25552BIOS_H_ISRE: equ 0xff2a553BIOS_H_NTFN: equ 0xff2f554BIOS_H_NOTR: equ 0xff34555BIOS_H_SNGF: equ 0xff39556BIOS_H_NEWS: equ 0xff3e557BIOS_H_GONE: equ 0xff43558BIOS_H_CHRG: equ 0xff48559BIOS_H_RETU: equ 0xff4d560BIOS_H_PRTF: equ 0xff52561BIOS_H_COMP: equ 0xff57562BIOS_H_FINP: equ 0xff5c563BIOS_H_TRMN: equ 0xff61564BIOS_H_FRME: equ 0xff66565BIOS_H_NTPL: equ 0xff6b566BIOS_H_EVAL: equ 0xff70567BIOS_H_OKNO: equ 0xff75568BIOS_H_FING: equ 0xff7a569BIOS_H_ISMI: equ 0xff7f570BIOS_H_WIDT: equ 0xff84571BIOS_H_LIST: equ 0xff89572BIOS_H_BUFL: equ 0xff8e573BIOS_H_FRQI: equ 0xff93574BIOS_H_SCNE: equ 0xff98575BIOS_H_FRET: equ 0xff9d576BIOS_H_PTRG: equ 0xffa2577BIOS_H_PHYD: equ 0xffa7578BIOS_H_FORM: equ 0xffac579BIOS_H_ERRO: equ 0xffb1580BIOS_H_LPTO: equ 0xffb6581BIOS_H_LPTS: equ 0xffbb582BIOS_H_SCRE: equ 0xffc0583BIOS_H_PLAY: equ 0xffc5585586BIOS_FCALL: equ 0xffca587BIOS_DISINT: equ 0xffcf588BIOS_ENAINT: equ 0xffd4592597598HKEYI: equ $fd9a 599HTIMI: equ $fd9f 601HOOK_SIZE: equ HTIMI - HKEYI604605MSXID1: equ $002b 609MSXID2: equ $002c 612MSXID3: equ $002d 617MSXID4: equ $002e 618MSXID5: equ $002f 619Main.s14 Include/MsxConstants.s1PORT_0: equ 0x982PORT_1: equ 0x993PORT_2: equ 0x9a4PORT_3: equ 0x9b78PPI.A: equ $a8 10PPI.B: equ $a9 11PPI.C: equ $aa 17PPI.R: equ $ab 2328MEMORY_MAPPER_SEGMENT_PAGE_0: equ 0xfc29MEMORY_MAPPER_SEGMENT_PAGE_1: equ 0xfd30MEMORY_MAPPER_SEGMENT_PAGE_2: equ 0xfe31MEMORY_MAPPER_SEGMENT_PAGE_3: equ 0xff3337REG0SAV: equ 0xF3DF38REG1SAV: equ 0xF3E039REG2SAV: equ 0xF3E140REG3SAV: equ 0xF3E241REG4SAV: equ 0xF3E342REG5SAV: equ 0xF3E443REG6SAV: equ 0xF3E544REG7SAV: equ 0xF3E646REG8SAV: equ 0xFFE747REG9SAV: equ 0xFFE848REG10SAV: equ 0xFFE949REG11SAV: equ 0xFFEA50REG12SAV: equ 0xFFEB51REG13SAV: equ 0xFFEC52REG14SAV: equ 0xFFED53REG15SAV: equ 0xFFEE54REG16SAV: equ 0xFFEF55REG17SAV: equ 0xFFF056REG18SAV: equ 0xFFF157REG19SAV: equ 0xFFF258REG20SAV: equ 0xFFF359REG21SAV: equ 0xFFF460REG22SAV: equ 0xFFF561REG23SAV: equ 0xFFF66365REG25SAV: equ 0xFFFA66REG26SAV: equ 0xFFFB67REG27SAV: equ 0xFFFC68Main.s15 Include/CommonRoutines.s149131724ClearRam_WithParameters:25.loop:26 xor a 27 ld (hl), a29 inc hl30 call BIOS_DCOMPR 31 ret z32 jp .loop3539SetPaletteColor:40 push bc41 42 ld b, a 43 ld c, 16 44 call BIOS_WRTVDP45 ld c, PORT_2 46 pop de48 ld a, d 49 di50 out (c), a51 ld a, e 52 ei53 out (c), a55 ret5964SetPaletteColor_FromAddress:65 66 ld b, a 67 ld c, 16 68 call BIOS_WRTVDP69 ld c, PORT_2 71 ld a, (hl) 72 di73 out (c), a74 inc hl75 ld a, (hl) 76 ei77 out (c), a79 ret8384LoadPalette:85 86 ld b, 0 87 ld c, 16 88 call BIOS_WRTVDP89 ld c, PORT_2 91 ld b, 1692.loop:93 di94 ld a, (hl)95 out (c), a96 inc hl97 ld a, (hl)98 out (c), a99 ei100 inc hl101 djnz .loop102 103 ret107108EnableRomPage2:109111 call BIOS_RSLREG112 rrca113 rrca114 and 3 115 ld c,a116 ld b,0117 ld hl, BIOS_EXPTBL118 add hl,bc119 ld a,(hl)120 and 80h121 or c122 ld c,a123 inc hl124 inc hl125 inc hl126 inc hl127 ld a,(hl)128 and 0Ch129 or c130 ld h,080h131 call BIOS_ENASLT 133 ret136140Wait_B_Vblanks:141 142 push bc143 144 .loop:146 ld a, (BIOS_JIFFY)147 ld c, a148 .waitVBlank:149 ld a, (BIOS_JIFFY)150 cp c151 jp z, .waitVBlank153 djnz .loop154 155 pop bc157 ret159Wait_15_Vblanks:160 ld c, 15162 .loop:163 ld a, (BIOS_JIFFY)164 ld b, a165 .waitVBlank:166 ld a, (BIOS_JIFFY)167 cp b168 jp z, .waitVBlank170 dec c171 jp nz, .loop173 ret175Wait_Vblank:176.loop:177 ld a, (BIOS_JIFFY)178 ld b, a179.waitVBlank:180 ld a, (BIOS_JIFFY)181 cp b182 jp z, .waitVBlank184 ret186188Wait:189 ld c, 15191 .loop:192 ld a, (BIOS_JIFFY)193 ld b, a194 .waitVBlank:195 ld a, (BIOS_JIFFY)196 cp b197 jp z, .waitVBlank199 dec c200 jp nz, .loop202206SetVdp_Write:208 217 rlc h218 rla219 rlc h220 rla221 srl h222 srl h224 di225 226 out (PORT_1), a227 ld a, 14 + 128228 out (PORT_1), a230 231 ld a, l232 nop233 out (PORT_1), a234 ld a, h235 or 64236 ei237 out (PORT_1),a238 ret240244SetVdp_Read:245 rlc h246 rla247 rlc h248 rla249 srl h250 srl h251 di252 out (PORT_1), a253 ld a, 14 + 128254 out (PORT_1), a255 ld a, l256 nop257 out (PORT_1), a258 ld a, h259 ei260 out (PORT_1), a261 ret264272293 294296298300302307315323326ClearVram_MSX2:327 xor a 328 ld hl, 0 329 call SetVDP_Write331341 xor a343 347 348 ld d, 2 349.loop_2:350 ld c, 0 351.loop_1:352 ld b, 0 353.loop:354 out (PORT_0), a355 djnz .loop356 dec c357 jp nz, .loop_1358 dec d359 jp nz, .loop_2361 ret364Screen11:365 367 ld a, 8368 call BIOS_CHGMOD370 ld a, (REG25SAV)371 or 0001 1000 b372 ld (REG25SAV), a 373 ld b, a374 375 ld c, 25 376 call BIOS_WRTVDP377 ret379SetSprites16x16:380 ld a, (REG1SAV)381 or 0000 0010 b382 ld b, a383 ld c, 1 384 call BIOS_WRTVDP385 ret387SetSpritesMagnified:388 ld a, (REG1SAV)389 or 0000 0001 b390 ld b, a391 ld c, 1 392 call BIOS_WRTVDP393 ret395Set192Lines:396 400 ld a, (REG9SAV)401 and 0111 1111 b402 ld b, a403 ld c, 9 404 call BIOS_WRTVDP405 ret407Set212Lines:408 409 ld a, (REG9SAV)410 or 1000 0000 b411 ld b, a412 ld c, 9 413 call BIOS_WRTVDP414 ret416SetNonInterlacedMode:417 418 ld a, (REG9SAV)419 and 1111 0011 b420 ld b, a421 ld c, 9 422 call BIOS_WRTVDP423 ret425SetInterlacedMode:426 427 ld a, (REG9SAV)428 or 0000 1100 b429 ld b, a430 ld c, 9 431 call BIOS_WRTVDP432 ret434SetColor0ToNonTransparent:435 440 ld a, (REG8SAV)441 or 0010 0000 b442 ld b, 0010 1000 b 443 ld c, 0x08 444 call BIOS_WRTVDP445 ret447SetColor0ToTransparent:448 449 ld a, (REG8SAV)450 and 1101 1111 b451 ld b, a452 ld c, 8 453 call BIOS_WRTVDP454 ret456DisableSprites:457 ld a, (REG8SAV)458 or 0000 0010 b459 ld b, a460 ld c, 8 461 call BIOS_WRTVDP462 ret464EnableSprites:465 ld a, (REG8SAV)466 and 1111 1101 b467 ld b, a468 ld c, 8 469 call BIOS_WRTVDP470 ret472476LDIRVM_MSX2:477 478 ex de, hl479 480 call SetVdp_Write481 ex de, hl482 ld d, c483 484 ld c, PORT_0 485 ld b, 0486.loop_1:487 otir488 dec d489 jp nz, .loop_1490 ret494512 521 525532CheckCollision_16x24_16x16:534 ld a, d 535 sub b 536 jr c, .x1IsLarger 537 sub 16 538 ret nc 539 jp .checkVerticalCollision540.x1IsLarger:541 neg 546 547 sub 16 548 ret nc 550.checkVerticalCollision:551 ld a, e 552 sub c 553 jr c, .y1IsLarger 554 sub 24 555 ret 556.y1IsLarger:557 neg 562 563 sub 16 564 ret 568573576586590593596601 602604611615617625 626634640647653656663669677679687694701704710712 714722727732736739750757762767770777782784790793795799803805808811814819 820823826 827832836839844 845848850 851856858862VDP_COMMAND_HMMC: equ 1111 0000 b 863VDP_COMMAND_YMMM: equ 1110 0000 b 864VDP_COMMAND_HMMM: equ 1101 0000 b 865VDP_COMMAND_HMMV: equ 1100 0000 b 867868VDP_COMMAND_LMMC: equ 1011 0000 b 869VDP_COMMAND_LMCM: equ 1010 0000 b 870VDP_COMMAND_LMMM: equ 1001 0000 b 871VDP_COMMAND_LMMV: equ 1000 0000 b 873VDP_COMMAND_LINE: equ 0111 0000 b874VDP_COMMAND_SRCH: equ 0110 0000 b875VDP_COMMAND_PSET: equ 0101 0000 b876VDP_COMMAND_POINT: equ 0100 0000 b878VDP_COMMAND_STOP: equ 0000 0000 b881882VDP_LOGIC_OPERATION_IMP: equ 0000 b883VDP_LOGIC_OPERATION_AND: equ 0001 b884VDP_LOGIC_OPERATION_OR: equ 0010 b885VDP_LOGIC_OPERATION_XOR: equ 0011 b886VDP_LOGIC_OPERATION_NOT: equ 0100 b888VDP_LOGIC_OPERATION_TIMP: equ 1000 b889VDP_LOGIC_OPERATION_TAND: equ 1001 b890VDP_LOGIC_OPERATION_TOR: equ 1010 b891VDP_LOGIC_OPERATION_TXOR: equ 1011 b892VDP_LOGIC_OPERATION_TNOT: equ 1100 b895899Execute_VDP_LMMM:900Execute_VDP_HMMM:901 ld a, 32 902 di903 out (PORT_1), a904 ld a, 17 + 128 905 out (PORT_1), a906 ld c, 0x9B 907.vdpReady:908 ld a, 2909 di910 out (PORT_1), a 911 ld a, 15 + 128912 out (PORT_1), a913 in a, (PORT_1)914 rra915 ld a, 0 916 out (PORT_1), a917 ld a, 15 + 128918 ei919 out (PORT_1), a 920 jp c, .vdpReady921 outi 922 outi 923 outi924 outi925 outi926 outi927 outi928 outi929 outi930 outi931 outi932 outi933 outi934 outi935 outi936 ret938941Execute_VDP_PSET:942Execute_VDP_LINE:943Execute_VDP_HMMV:944Execute_VDP_HMMC_Init:945 ld a, 36 946 di947 out (PORT_1), a948 ld a, 17 + 128949 out (PORT_1), a950 ld c, 0x9B951.vdpReady:952 ld a, 2953 di954 out (PORT_1), a 955 ld a, 15 + 128956 out (PORT_1), a957 in a, (PORT_1)958 rra959 ld a, 0 960 out (PORT_1), a961 ld a, 15 + 128962 ei963 out (PORT_1), a 964 jp c, .vdpReady965 outi 966 outi 967 outi968 outi969 outi970 outi971 outi972 outi973 outi974 outi975 outi976 ret979991993Execute_VDP_HMMC:994 995 push hl, de996 call Execute_VDP_HMMC_Init997 pop de, hl1000 1001 push de1002 ld bc, 41003 add hl, bc 1005 1006 ld b, (hl) 1007 ld c, 40 1008 call BIOS_WRTVDP1009 inc hl1011 ld b, (hl) 1012 ld c, 41 1013 call BIOS_WRTVDP1014 inc hl1016 ld b, (hl) 1017 ld c, 42 1018 call BIOS_WRTVDP1019 inc hl1021 ld b, (hl) 1022 ld c, 43 1023 call BIOS_WRTVDP1024 inc hl1027 1028 ld b, 0xf0 1029 ld c, 46 1030 call BIOS_WRTVDP1031 pop hl 1032 1033 1034.readS2:1035 ld a, 21036 di1037 out (PORT_1), a 1038 ld a, 15 + 1281039 out (PORT_1), a1040 in a, (PORT_1)1041 ld b, a 1042 ld a, 0 1043 out (PORT_1), a1044 ld a, 15 + 1281045 ei1046 out (PORT_1), a1048 1052 1053 ld a, b1054 and 0000 0001 b1055 ret z1056 1057 1058 ld a, b1059 and 1000 000 b1060 jp z, .readS21062.dataTransmit:1064 1066 10741086 1088 ld b, 128 + 44 1089 ld c, 17 1090 call BIOS_WRTVDP1092 ld c, PORT_31093 ld b, 32 1094 otir1096 jp .readS21100 11021105Execute_VDP_YMMM:1106 ld a, 34 1107 di1108 out (PORT_1), a1109 ld a, 17 + 1281110 out (PORT_1), a1111 ld c, 0x9B1112.vdpReady:1113 ld a, 21114 di1115 out (PORT_1), a 1116 ld a, 15 + 1281117 out (PORT_1), a1118 in a, (PORT_1)1119 rra1120 ld a, 0 1121 out (PORT_1), a1122 ld a, 15 + 1281123 ei1124 out (PORT_1), a 1125 jp c, .vdpReady1126 outi 1127 outi 1128 outi1129 outi1130 outi1131 outi1132 outi1133 outi1134 outi1135 outi1136 outi1137 outi1138 outi1139 ret114211441148ReadStatusReg:11491150 ld a,(0007h) 1151 inc a1152 ld c,a 1154 out (c),b1155 ld a,080h+151156 out (c),a11571158 1159 ld a,(0006h) 1160 inc a1161 ld c,a 1162 in b,(c) 1163 11641165 ld a,(0007h) 1166 inc a1167 ld c,a 1168 xor a1169 out (c),a1170 ld a,080h+151171 out (c),a1172 1174 ret11771178WRTVDP_without_DI_EI:1179 ld a, b1180 1181 out (PORT_1),a1182 ld a, c1183 or 1281184 1186 out (PORT_1), a1187 ret11911194SNSMAT_NO_DI_EI:1195 ld c, a1196.C_OK:11971198 in a, (PPI.C)1199 and 0xf0 1200 or c12011202 out (PPI.C), a1203 in a, (PPI.B)1204 ret1207Comp_BC_DE:1208 ld a, b1209 sub d1210 ret nz1211 ld a, c1212 sub e1213 ret12151217PrintString:1218 ld a, (hl)1219 or a 1220 ret z1221 call BIOS_CHPUT1222 inc hl1223 jr PrintString12251227PrintString_CrLf:1228 call PrintString1229 ld a, 131230 call BIOS_CHPUT1231 ld a, 101232 call BIOS_CHPUT1233 ret1234Main.s16 17 Include/Math.s16Div8:7 xor a8 ld b,89Div8_Loop:10 rl e11 rla12 sub c13 jr nc,Div8_NoAdd14 add a,c15Div8_NoAdd:16 djnz Div8_Loop17 ld b,a18 ld a,e19 rla20 cpl21 ret2328Div16:29 ld hl,030 ld a,b31 ld b,832Div16_Loop1:33 rla34 adc hl,hl35 sbc hl,de36 jr nc,Div16_NoAdd137 add hl,de38Div16_NoAdd1:39 djnz Div16_Loop140 rla41 cpl42 ld b,a43 ld a,c44 ld c,b45 ld b,846Div16_Loop2:47 rla48 adc hl,hl49 sbc hl,de50 jr nc,Div16_NoAdd251 add hl,de52Div16_NoAdd2:53 djnz Div16_Loop254 rla55 cpl56 ld b,c57 ld c,a58 ret6065Mult8:66 ld d,067 ld l,d68 ld b,869Mult8_Loop:70 add hl,hl71 jr nc,Mult8_NoAdd72 add hl,de73Mult8_NoAdd:74 djnz Mult8_Loop75 ret78FPDE_Div_BC88:7984 ld a,1685 ld hl,086Loop1:87 sla e88 rl d89 adc hl,hl90 jr nc,$+891 or a92 sbc hl,bc93 jp incE94 sbc hl,bc95 jr c,$+596incE:97 inc e98 jr $+399 add hl,bc100 dec a101 jr nz,Loop1102 ex af,af'103 ld a,8104Loop2:105 ex af,af'106 sla e107 rl d108 rla109 ex af,af'110 add hl,hl111 jr nc,$+8112 or a113 sbc hl,bc114 jp incE_2115 sbc hl,bc116 jr c,$+5117incE_2:118 inc e119 jr $+3120 add hl,bc121 dec a122 jr nz,Loop2123124 ex af,af'125 add hl,hl126 jr c,$+5127 sbc hl,de128 ret c129 inc e130 ret nz131 inc d132 ret nz133 inc a134 ret135Main.s19 20 21 LookUpTables/LUT_Cos_Sin.s12LUT_cos:3 dw 100000000 b 4 dw 100000000 b 5 dw 100000000 b 6 dw 100000000 b 7 dw 11111111 b 8 dw 11111111 b 9 dw 11111111 b 10 dw 11111110 b 11 dw 11111110 b 12 dw 11111101 b 13 dw 11111100 b 14 dw 11111011 b 15 dw 11111010 b 16 dw 11111001 b 17 dw 11111000 b 18 dw 11110111 b 19 dw 11110110 b 20 dw 11110101 b 21 dw 11110011 b 22 dw 11110010 b 23 dw 11110001 b 24 dw 11101111 b 25 dw 11101101 b 26 dw 11101100 b 27 dw 11101010 b 28 dw 11101000 b 29 dw 11100110 b 30 dw 11100100 b 31 dw 11100010 b 32 dw 11100000 b 33 dw 11011110 b 34 dw 11011011 b 35 dw 11011001 b 36 dw 11010111 b 37 dw 11010100 b 38 dw 11010010 b 39 dw 11001111 b 40 dw 11001100 b 41 dw 11001010 b 42 dw 11000111 b 43 dw 11000100 b 44 dw 11000001 b 45 dw 10111110 b 46 dw 10111011 b 47 dw 10111000 b 48 dw 10110101 b 49 dw 10110010 b 50 dw 10101111 b 51 dw 10101011 b 52 dw 10101000 b 53 dw 10100101 b 54 dw 10100001 b 55 dw 10011110 b 56 dw 10011010 b 57 dw 10010110 b 58 dw 10010011 b 59 dw 10001111 b 60 dw 10001011 b 61 dw 10001000 b 62 dw 10000100 b 63 dw 10000000 b 64 dw 1111100 b 65 dw 1111000 b 66 dw 1110100 b 67 dw 1110000 b 68 dw 1101100 b 69 dw 1101000 b 70 dw 1100100 b 71 dw 1100000 b 72 dw 1011100 b 73 dw 1011000 b 74 dw 1010011 b 75 dw 1001111 b 76 dw 1001011 b 77 dw 1000111 b 78 dw 1000010 b 79 dw 111110 b 80 dw 111010 b 81 dw 110101 b 82 dw 110001 b 83 dw 101100 b 84 dw 101000 b 85 dw 100100 b 86 dw 11111 b 87 dw 11011 b 88 dw 10110 b 89 dw 10010 b 90 dw 1101 b 91 dw 1001 b 92 dw 100 b 93 dw 0 b 94 dw 1111111111111100 b 95 dw 1111111111110111 b 96 dw 1111111111110011 b 97 dw 1111111111101110 b 98 dw 1111111111101010 b 99 dw 1111111111100101 b 100 dw 1111111111100001 b 101 dw 1111111111011100 b 102 dw 1111111111011000 b 103 dw 1111111111010100 b 104 dw 1111111111001111 b 105 dw 1111111111001011 b 106 dw 1111111111000110 b 107 dw 1111111111000010 b 108 dw 1111111110111110 b 109 dw 1111111110111001 b 110 dw 1111111110110101 b 111 dw 1111111110110001 b 112 dw 1111111110101101 b 113 dw 1111111110101000 b 114 dw 1111111110100100 b 115 dw 1111111110100000 b 116 dw 1111111110011100 b 117 dw 1111111110011000 b 118 dw 1111111110010100 b 119 dw 1111111110010000 b 120 dw 1111111110001100 b 121 dw 1111111110001000 b 122 dw 1111111110000100 b 123 dw 1111111110000000 b 124 dw 1111111101111100 b 125 dw 1111111101111000 b 126 dw 1111111101110101 b 127 dw 1111111101110001 b 128 dw 1111111101101101 b 129 dw 1111111101101010 b 130 dw 1111111101100110 b 131 dw 1111111101100010 b 132 dw 1111111101011111 b 133 dw 1111111101011011 b 134 dw 1111111101011000 b 135 dw 1111111101010101 b 136 dw 1111111101010001 b 137 dw 1111111101001110 b 138 dw 1111111101001011 b 139 dw 1111111101001000 b 140 dw 1111111101000101 b 141 dw 1111111101000010 b 142 dw 1111111100111111 b 143 dw 1111111100111100 b 144 dw 1111111100111001 b 145 dw 1111111100110110 b 146 dw 1111111100110100 b 147 dw 1111111100110001 b 148 dw 1111111100101110 b 149 dw 1111111100101100 b 150 dw 1111111100101001 b 151 dw 1111111100100111 b 152 dw 1111111100100101 b 153 dw 1111111100100010 b 154 dw 1111111100100000 b 155 dw 1111111100011110 b 156 dw 1111111100011100 b 157 dw 1111111100011010 b 158 dw 1111111100011000 b 159 dw 1111111100010110 b 160 dw 1111111100010100 b 161 dw 1111111100010011 b 162 dw 1111111100010001 b 163 dw 1111111100001111 b 164 dw 1111111100001110 b 165 dw 1111111100001101 b 166 dw 1111111100001011 b 167 dw 1111111100001010 b 168 dw 1111111100001001 b 169 dw 1111111100001000 b 170 dw 1111111100000111 b 171 dw 1111111100000110 b 172 dw 1111111100000101 b 173 dw 1111111100000100 b 174 dw 1111111100000011 b 175 dw 1111111100000010 b 176 dw 1111111100000010 b 177 dw 1111111100000001 b 178 dw 1111111100000001 b 179 dw 1111111100000001 b 180 dw 1111111100000000 b 181 dw 1111111100000000 b 182 dw 1111111100000000 b 183 dw 1111111100000000 b 184 dw 1111111100000000 b 185 dw 1111111100000000 b 186 dw 1111111100000000 b 187 dw 1111111100000001 b 188 dw 1111111100000001 b 189 dw 1111111100000001 b 190 dw 1111111100000010 b 191 dw 1111111100000010 b 192 dw 1111111100000011 b 193 dw 1111111100000100 b 194 dw 1111111100000101 b 195 dw 1111111100000110 b 196 dw 1111111100000111 b 197 dw 1111111100001000 b 198 dw 1111111100001001 b 199 dw 1111111100001010 b 200 dw 1111111100001011 b 201 dw 1111111100001101 b 202 dw 1111111100001110 b 203 dw 1111111100001111 b 204 dw 1111111100010001 b 205 dw 1111111100010011 b 206 dw 1111111100010100 b 207 dw 1111111100010110 b 208 dw 1111111100011000 b 209 dw 1111111100011010 b 210 dw 1111111100011100 b 211 dw 1111111100011110 b 212 dw 1111111100100000 b 213 dw 1111111100100010 b 214 dw 1111111100100101 b 215 dw 1111111100100111 b 216 dw 1111111100101001 b 217 dw 1111111100101100 b 218 dw 1111111100101110 b 219 dw 1111111100110001 b 220 dw 1111111100110100 b 221 dw 1111111100110110 b 222 dw 1111111100111001 b 223 dw 1111111100111100 b 224 dw 1111111100111111 b 225 dw 1111111101000010 b 226 dw 1111111101000101 b 227 dw 1111111101001000 b 228 dw 1111111101001011 b 229 dw 1111111101001110 b 230 dw 1111111101010001 b 231 dw 1111111101010101 b 232 dw 1111111101011000 b 233 dw 1111111101011011 b 234 dw 1111111101011111 b 235 dw 1111111101100010 b 236 dw 1111111101100110 b 237 dw 1111111101101010 b 238 dw 1111111101101101 b 239 dw 1111111101110001 b 240 dw 1111111101110101 b 241 dw 1111111101111000 b 242 dw 1111111101111100 b 243 dw 1111111110000000 b 244 dw 1111111110000100 b 245 dw 1111111110001000 b 246 dw 1111111110001100 b 247 dw 1111111110010000 b 248 dw 1111111110010100 b 249 dw 1111111110011000 b 250 dw 1111111110011100 b 251 dw 1111111110100000 b 252 dw 1111111110100100 b 253 dw 1111111110101000 b 254 dw 1111111110101101 b 255 dw 1111111110110001 b 256 dw 1111111110110101 b 257 dw 1111111110111001 b 258 dw 1111111110111110 b 259 dw 1111111111000010 b 260 dw 1111111111000110 b 261 dw 1111111111001011 b 262 dw 1111111111001111 b 263 dw 1111111111010100 b 264 dw 1111111111011000 b 265 dw 1111111111011100 b 266 dw 1111111111100001 b 267 dw 1111111111100101 b 268 dw 1111111111101010 b 269 dw 1111111111101110 b 270 dw 1111111111110011 b 271 dw 1111111111110111 b 272 dw 1111111111111100 b 273 dw 0 b 274 dw 100 b 275 dw 1001 b 276 dw 1101 b 277 dw 10010 b 278 dw 10110 b 279 dw 11011 b 280 dw 11111 b 281 dw 100100 b 282 dw 101000 b 283 dw 101100 b 284 dw 110001 b 285 dw 110101 b 286 dw 111010 b 287 dw 111110 b 288 dw 1000010 b 289 dw 1000111 b 290 dw 1001011 b 291 dw 1001111 b 292 dw 1010011 b 293 dw 1011000 b 294 dw 1011100 b 295 dw 1100000 b 296 dw 1100100 b 297 dw 1101000 b 298 dw 1101100 b 299 dw 1110000 b 300 dw 1110100 b 301 dw 1111000 b 302 dw 1111100 b 303 dw 10000000 b 304 dw 10000100 b 305 dw 10001000 b 306 dw 10001011 b 307 dw 10001111 b 308 dw 10010011 b 309 dw 10010110 b 310 dw 10011010 b 311 dw 10011110 b 312 dw 10100001 b 313 dw 10100101 b 314 dw 10101000 b 315 dw 10101011 b 316 dw 10101111 b 317 dw 10110010 b 318 dw 10110101 b 319 dw 10111000 b 320 dw 10111011 b 321 dw 10111110 b 322 dw 11000001 b 323 dw 11000100 b 324 dw 11000111 b 325 dw 11001010 b 326 dw 11001100 b 327 dw 11001111 b 328 dw 11010010 b 329 dw 11010100 b 330 dw 11010111 b 331 dw 11011001 b 332 dw 11011011 b 333 dw 11011110 b 334 dw 11100000 b 335 dw 11100010 b 336 dw 11100100 b 337 dw 11100110 b 338 dw 11101000 b 339 dw 11101010 b 340 dw 11101100 b 341 dw 11101101 b 342 dw 11101111 b 343 dw 11110001 b 344 dw 11110010 b 345 dw 11110011 b 346 dw 11110101 b 347 dw 11110110 b 348 dw 11110111 b 349 dw 11111000 b 350 dw 11111001 b 351 dw 11111010 b 352 dw 11111011 b 353 dw 11111100 b 354 dw 11111101 b 355 dw 11111110 b 356 dw 11111110 b 357 dw 11111111 b 358 dw 11111111 b 359 dw 11111111 b 360 dw 100000000 b 361 dw 100000000 b 362 dw 100000000 b 364LUT_sin:365 dw 0 b 366 dw 1111111111111100 b 367 dw 1111111111110111 b 368 dw 1111111111110011 b 369 dw 1111111111101110 b 370 dw 1111111111101010 b 371 dw 1111111111100101 b 372 dw 1111111111100001 b 373 dw 1111111111011100 b 374 dw 1111111111011000 b 375 dw 1111111111010100 b 376 dw 1111111111001111 b 377 dw 1111111111001011 b 378 dw 1111111111000110 b 379 dw 1111111111000010 b 380 dw 1111111110111110 b 381 dw 1111111110111001 b 382 dw 1111111110110101 b 383 dw 1111111110110001 b 384 dw 1111111110101101 b 385 dw 1111111110101000 b 386 dw 1111111110100100 b 387 dw 1111111110100000 b 388 dw 1111111110011100 b 389 dw 1111111110011000 b 390 dw 1111111110010100 b 391 dw 1111111110010000 b 392 dw 1111111110001100 b 393 dw 1111111110001000 b 394 dw 1111111110000100 b 395 dw 1111111110000000 b 396 dw 1111111101111100 b 397 dw 1111111101111000 b 398 dw 1111111101110101 b 399 dw 1111111101110001 b 400 dw 1111111101101101 b 401 dw 1111111101101010 b 402 dw 1111111101100110 b 403 dw 1111111101100010 b 404 dw 1111111101011111 b 405 dw 1111111101011011 b 406 dw 1111111101011000 b 407 dw 1111111101010101 b 408 dw 1111111101010001 b 409 dw 1111111101001110 b 410 dw 1111111101001011 b 411 dw 1111111101001000 b 412 dw 1111111101000101 b 413 dw 1111111101000010 b 414 dw 1111111100111111 b 415 dw 1111111100111100 b 416 dw 1111111100111001 b 417 dw 1111111100110110 b 418 dw 1111111100110100 b 419 dw 1111111100110001 b 420 dw 1111111100101110 b 421 dw 1111111100101100 b 422 dw 1111111100101001 b 423 dw 1111111100100111 b 424 dw 1111111100100101 b 425 dw 1111111100100010 b 426 dw 1111111100100000 b 427 dw 1111111100011110 b 428 dw 1111111100011100 b 429 dw 1111111100011010 b 430 dw 1111111100011000 b 431 dw 1111111100010110 b 432 dw 1111111100010100 b 433 dw 1111111100010011 b 434 dw 1111111100010001 b 435 dw 1111111100001111 b 436 dw 1111111100001110 b 437 dw 1111111100001101 b 438 dw 1111111100001011 b 439 dw 1111111100001010 b 440 dw 1111111100001001 b 441 dw 1111111100001000 b 442 dw 1111111100000111 b 443 dw 1111111100000110 b 444 dw 1111111100000101 b 445 dw 1111111100000100 b 446 dw 1111111100000011 b 447 dw 1111111100000010 b 448 dw 1111111100000010 b 449 dw 1111111100000001 b 450 dw 1111111100000001 b 451 dw 1111111100000001 b 452 dw 1111111100000000 b 453 dw 1111111100000000 b 454 dw 1111111100000000 b 455 dw 1111111100000000 b 456 dw 1111111100000000 b 457 dw 1111111100000000 b 458 dw 1111111100000000 b 459 dw 1111111100000001 b 460 dw 1111111100000001 b 461 dw 1111111100000001 b 462 dw 1111111100000010 b 463 dw 1111111100000010 b 464 dw 1111111100000011 b 465 dw 1111111100000100 b 466 dw 1111111100000101 b 467 dw 1111111100000110 b 468 dw 1111111100000111 b 469 dw 1111111100001000 b 470 dw 1111111100001001 b 471 dw 1111111100001010 b 472 dw 1111111100001011 b 473 dw 1111111100001101 b 474 dw 1111111100001110 b 475 dw 1111111100001111 b 476 dw 1111111100010001 b 477 dw 1111111100010011 b 478 dw 1111111100010100 b 479 dw 1111111100010110 b 480 dw 1111111100011000 b 481 dw 1111111100011010 b 482 dw 1111111100011100 b 483 dw 1111111100011110 b 484 dw 1111111100100000 b 485 dw 1111111100100010 b 486 dw 1111111100100101 b 487 dw 1111111100100111 b 488 dw 1111111100101001 b 489 dw 1111111100101100 b 490 dw 1111111100101110 b 491 dw 1111111100110001 b 492 dw 1111111100110100 b 493 dw 1111111100110110 b 494 dw 1111111100111001 b 495 dw 1111111100111100 b 496 dw 1111111100111111 b 497 dw 1111111101000010 b 498 dw 1111111101000101 b 499 dw 1111111101001000 b 500 dw 1111111101001011 b 501 dw 1111111101001110 b 502 dw 1111111101010001 b 503 dw 1111111101010101 b 504 dw 1111111101011000 b 505 dw 1111111101011011 b 506 dw 1111111101011111 b 507 dw 1111111101100010 b 508 dw 1111111101100110 b 509 dw 1111111101101010 b 510 dw 1111111101101101 b 511 dw 1111111101110001 b 512 dw 1111111101110101 b 513 dw 1111111101111000 b 514 dw 1111111101111100 b 515 dw 1111111110000000 b 516 dw 1111111110000100 b 517 dw 1111111110001000 b 518 dw 1111111110001100 b 519 dw 1111111110010000 b 520 dw 1111111110010100 b 521 dw 1111111110011000 b 522 dw 1111111110011100 b 523 dw 1111111110100000 b 524 dw 1111111110100100 b 525 dw 1111111110101000 b 526 dw 1111111110101101 b 527 dw 1111111110110001 b 528 dw 1111111110110101 b 529 dw 1111111110111001 b 530 dw 1111111110111110 b 531 dw 1111111111000010 b 532 dw 1111111111000110 b 533 dw 1111111111001011 b 534 dw 1111111111001111 b 535 dw 1111111111010100 b 536 dw 1111111111011000 b 537 dw 1111111111011100 b 538 dw 1111111111100001 b 539 dw 1111111111100101 b 540 dw 1111111111101010 b 541 dw 1111111111101110 b 542 dw 1111111111110011 b 543 dw 1111111111110111 b 544 dw 1111111111111100 b 545 dw 0 b 546 dw 100 b 547 dw 1001 b 548 dw 1101 b 549 dw 10010 b 550 dw 10110 b 551 dw 11011 b 552 dw 11111 b 553 dw 100100 b 554 dw 101000 b 555 dw 101100 b 556 dw 110001 b 557 dw 110101 b 558 dw 111010 b 559 dw 111110 b 560 dw 1000010 b 561 dw 1000111 b 562 dw 1001011 b 563 dw 1001111 b 564 dw 1010011 b 565 dw 1011000 b 566 dw 1011100 b 567 dw 1100000 b 568 dw 1100100 b 569 dw 1101000 b 570 dw 1101100 b 571 dw 1110000 b 572 dw 1110100 b 573 dw 1111000 b 574 dw 1111100 b 575 dw 10000000 b 576 dw 10000100 b 577 dw 10001000 b 578 dw 10001011 b 579 dw 10001111 b 580 dw 10010011 b 581 dw 10010110 b 582 dw 10011010 b 583 dw 10011110 b 584 dw 10100001 b 585 dw 10100101 b 586 dw 10101000 b 587 dw 10101011 b 588 dw 10101111 b 589 dw 10110010 b 590 dw 10110101 b 591 dw 10111000 b 592 dw 10111011 b 593 dw 10111110 b 594 dw 11000001 b 595 dw 11000100 b 596 dw 11000111 b 597 dw 11001010 b 598 dw 11001100 b 599 dw 11001111 b 600 dw 11010010 b 601 dw 11010100 b 602 dw 11010111 b 603 dw 11011001 b 604 dw 11011011 b 605 dw 11011110 b 606 dw 11100000 b 607 dw 11100010 b 608 dw 11100100 b 609 dw 11100110 b 610 dw 11101000 b 611 dw 11101010 b 612 dw 11101100 b 613 dw 11101101 b 614 dw 11101111 b 615 dw 11110001 b 616 dw 11110010 b 617 dw 11110011 b 618 dw 11110101 b 619 dw 11110110 b 620 dw 11110111 b 621 dw 11111000 b 622 dw 11111001 b 623 dw 11111010 b 624 dw 11111011 b 625 dw 11111100 b 626 dw 11111101 b 627 dw 11111110 b 628 dw 11111110 b 629 dw 11111111 b 630 dw 11111111 b 631 dw 11111111 b 632 dw 100000000 b 633 dw 100000000 b 634 dw 100000000 b 635 dw 100000000 b 636 dw 100000000 b 637 dw 100000000 b 638 dw 100000000 b 639 dw 11111111 b 640 dw 11111111 b 641 dw 11111111 b 642 dw 11111110 b 643 dw 11111110 b 644 dw 11111101 b 645 dw 11111100 b 646 dw 11111011 b 647 dw 11111010 b 648 dw 11111001 b 649 dw 11111000 b 650 dw 11110111 b 651 dw 11110110 b 652 dw 11110101 b 653 dw 11110011 b 654 dw 11110010 b 655 dw 11110001 b 656 dw 11101111 b 657 dw 11101101 b 658 dw 11101100 b 659 dw 11101010 b 660 dw 11101000 b 661 dw 11100110 b 662 dw 11100100 b 663 dw 11100010 b 664 dw 11100000 b 665 dw 11011110 b 666 dw 11011011 b 667 dw 11011001 b 668 dw 11010111 b 669 dw 11010100 b 670 dw 11010010 b 671 dw 11001111 b 672 dw 11001100 b 673 dw 11001010 b 674 dw 11000111 b 675 dw 11000100 b 676 dw 11000001 b 677 dw 10111110 b 678 dw 10111011 b 679 dw 10111000 b 680 dw 10110101 b 681 dw 10110010 b 682 dw 10101111 b 683 dw 10101011 b 684 dw 10101000 b 685 dw 10100101 b 686 dw 10100001 b 687 dw 10011110 b 688 dw 10011010 b 689 dw 10010110 b 690 dw 10010011 b 691 dw 10001111 b 692 dw 10001011 b 693 dw 10001000 b 694 dw 10000100 b 695 dw 10000000 b 696 dw 1111100 b 697 dw 1111000 b 698 dw 1110100 b 699 dw 1110000 b 700 dw 1101100 b 701 dw 1101000 b 702 dw 1100100 b 703 dw 1100000 b 704 dw 1011100 b 705 dw 1011000 b 706 dw 1010011 b 707 dw 1001111 b 708 dw 1001011 b 709 dw 1000111 b 710 dw 1000010 b 711 dw 111110 b 712 dw 111010 b 713 dw 110101 b 714 dw 110001 b 715 dw 101100 b 716 dw 101000 b 717 dw 100100 b 718 dw 11111 b 719 dw 11011 b 720 dw 10110 b 721 dw 10010 b 722 dw 1101 b 723 dw 1001 b 724 dw 100 b 725 Main.s22 LookUpTables/LUT_Atan2.s12LUT_Atan2:3 dw 0, 04 dw 16, 45 dw 32, 76 dw 48, 117 dw 64, 148 dw 80, 179 dw 96, 2110 dw 112, 2411 dw 128, 2712 dw 144, 2913 dw 160, 3214 dw 176, 3515 dw 192, 3716 dw 208, 3917 dw 224, 4118 dw 240, 431920 dw 256, 4521 22 dw 273, 4723 dw 293, 4924 dw 315, 5125 dw 341, 5326 dw 372, 5527 dw 410, 5828 dw 455, 6129 dw 512, 6330 dw 585, 6631 dw 683, 6932 dw 819, 7333 dw 1024, 7634 dw 1365, 7935 dw 2048, 8336 dw 4096, 8637.end:Main.s23 24 ReadInput.s1ReadInput:2 3 ld a, 8 4 call BIOS_SNSMAT 5 6 push af7 bit 4, a 8 call z, .rotateLeft9 pop af11 push af12 bit 7, a 13 call z, .rotateRight14 pop af16 push af17 bit 5, a 18 call z, .walkForward19 pop af21 push af22 bit 6, a 23 call z, .walkBackwards24 pop af27 ret30.rotateRight:31 32 ld hl, (Player.angle)33 ld de, 034 call BIOS_DCOMPR 35 jr z, .rotateRight_set35937 dec hl38 jp .rotate_return40.rotateRight_set359:41 ld hl, 35942 jp .rotate_return46.rotateLeft:47 48 ld hl, (Player.angle)49 ld de, 360-150 call BIOS_DCOMPR 51 jr z, .rotateLeft_set053 inc hl54 jp .rotate_return56.rotateLeft_set0:57 ld hl, 059.rotate_return:60 ld (Player.angle), hl62 call Update_FoV64 call Update_walkDXandDY66 ret68.walkForward:70 71 ld hl, (Player.Y)72 ld de, (Player.walk_DY)74 add hl, de75 ld (Player.Y), hl77 79 80 ld hl, (Player.X)81 ld de, (Player.walk_DX)83 add hl, de84 ld (Player.X), hl86 ret88.walkBackwards:90 91 ld hl, (Player.Y)92 ld de, (Player.walk_DY)94 xor a 95 sbc hl, de96 ld (Player.Y), hl98 100 101 ld hl, (Player.X)102 ld de, (Player.walk_DX)104 xor a 105 sbc hl, de106 ld (Player.X), hl108 ret110117122124Update_walkDXandDY:125 126 ld hl, (Player.angle)127 128 add hl, hl 130 ld d, h 131 ld e, l133 ld hl, LUT_cos 134 add hl, de136 ld e, (hl) 137 inc hl138 ld d, (hl)140 ld (Player.walk_DX), de141 145 146 ld hl, (Player.angle)147 148 add hl, hl 150 ld d, h 151 ld e, l153 ld hl, LUT_sin 154 add hl, de156 ld e, (hl) 157 inc hl158 ld d, (hl)160 164 165 169 171 ld (Player.walk_DY), de173 ret177Update_FoV:178 ld hl, (Player.angle)180 181 ld de, PLAYER_FIELD_OF_VIEW / 2182 call BIOS_DCOMPR 183 jp nc, .set_FoV_start_angle_minus_32185 187 ld bc, 360 - (PLAYER_FIELD_OF_VIEW / 2)188 ld hl, (Player.angle)189 add hl, bc190 ld (Player.FoV_start), hl191 192 jp .cont194.set_FoV_start_angle_minus_32:195 196 ld hl, (Player.angle)197 ld bc, PLAYER_FIELD_OF_VIEW / 2198 xor a199 sbc hl, bc200 ld (Player.FoV_start), hl203.cont:205 ld hl, (Player.angle)207 208 ld de, 360 - (PLAYER_FIELD_OF_VIEW / 2)209 call BIOS_DCOMPR 210 jp c, .set_FoV_end_angle_plus_32213 215 ld bc, - 360 + (PLAYER_FIELD_OF_VIEW / 2)216 ld hl, (Player.angle)217 add hl, bc218 ld (Player.FoV_end), hl220 ret222.set_FoV_end_angle_plus_32:223 224 ld hl, (Player.angle)225 ld bc, PLAYER_FIELD_OF_VIEW / 2226 add hl, bc227 ld (Player.FoV_end), hl230 retMain.s25 GameLogic/PlayerInit.s1PlayerInit:3 ld hl, 32768 4 ld (Player.X), hl5 ld (Player.Y), hl6 ld hl, 07 ld (Player.angle), hl9 call Update_FoV10 call Update_walkDXandDY12 retMain.s26 GameLogic/ObjectLogic.s1PLAYER_FIELD_OF_VIEW: equ 64 3ObjectLogic:5 ld (ObjectAddress), hl 7 8 ld de, Object_Temp9 ld bc, Object_Temp.size10 ldir12 13 14 push hl15 ld e, (hl) 16 inc hl17 ld d, (hl)19 ld hl, (Player.X)21 call .calcAbsoluteDistance23 ld (Object_Temp.distance_X), hl24 pop hl29 30 inc hl31 inc hl33 ld e, (hl) 34 inc hl35 ld d, (hl)37 ld hl, (Player.Y)39 call .calcAbsoluteDistance41 ld (Object_Temp.distance_Y), hl46 51 52 59 62 63 67 68 ld bc, (Object_Temp.distance_X)69 70 71 ld de, 072 call Comp_BC_DE 73 jp z, .ret90degrees74 75 ld de, (Object_Temp.distance_Y)77 di78 call FPDE_Div_BC88 79 ei80 83 84 85 86 8990 ld b, d 91 ld c, e93 ld hl, LUT_Atan295.loop:96 ld e, (hl)97 inc hl98 ld d, (hl)100 103 106 107 call Comp_BC_DE 108 jp z, .getAngle 109 jp nc, .next 111.getAngle:112 inc hl114 ld e, (hl)115 inc hl116 ld d, (hl)118 jp .cont_1120.ret90degrees:121 ld de, 90123.cont_1:125 ld (Object_Temp.angleToPlayer), de 127 129 130 ld hl, (Player.Y)131 ld de, (Object_Temp.Y)132 call BIOS_DCOMPR 133 jp c, .player_Y_isLessThan_object_Y134 135 136 ld hl, (Player.X)137 ld de, (Object_Temp.X)138 call BIOS_DCOMPR 139 jp nc, .angle2ndQuadrant141 jp .cont_2143.player_Y_isLessThan_object_Y:145 146 ld hl, (Player.X)147 ld de, (Object_Temp.X)148 call BIOS_DCOMPR 149 jp nc, .angle3rdQuadrant150 jp .angle4thQuadrant153.cont_2:155 157 158 160 ld de, (Object_Temp.angleToPlayer)161 163 ld hl, (Player.angle)164 ld bc, PLAYER_FIELD_OF_VIEW / 2 165 xor a166 sbc hl, bc168 169 call BIOS_DCOMPR 170 jp nc, .outOfView172 ld de, (Object_Temp.angleToPlayer)173 175 ld hl, (Player.angle)176 ld bc, PLAYER_FIELD_OF_VIEW / 2 177 add hl, bc179 180 call BIOS_DCOMPR 181 jp nc, .isVisible183.outOfView:184 xor a185 ld (Object_Temp.isVisible), a186 jp .cont_100188.isVisible:189 ld a, 1190 ld (Object_Temp.isVisible), a192.cont_100:194.return:196 197 ld hl, Object_Temp198 ld de, (ObjectAddress)199 ld bc, Object_Temp.size200 ldir203 ret205.next:206 inc hl207 inc hl208 inc hl210 ld de, LUT_Atan2.end211 call BIOS_DCOMPR 212 213 214 jp c, .loop215 jp .ret90degrees220.calcAbsoluteDistance:221 222 call BIOS_DCOMPR 223 jp c, .DE_isBigger224 jp .HL_isBiggerOrEqual225.DE_isBigger:226 ex de, hl227.HL_isBiggerOrEqual:228 xor a 229 sbc hl, de231 ret233234.angle2ndQuadrant:235 236 ld hl, 180237 ld bc, (Object_Temp.angleToPlayer) 238 xor a239 sbc hl, bc240 ld (Object_Temp.angleToPlayer), hl242 jp .cont_2244245.angle4thQuadrant:246 247 ld hl, 360248 ld bc, (Object_Temp.angleToPlayer) 249 xor a250 sbc hl, bc251 ld (Object_Temp.angleToPlayer), hl253 jp .cont_2255256.angle3rdQuadrant:257 258 ld hl, 270259 ld bc, (Object_Temp.angleToPlayer) 260 xor a261 sbc hl, bc262 ld (Object_Temp.angleToPlayer), hl264 jp .cont_2265Main.s27 UpdateSPRATR.s1UpdateSPRATR:3 4 ld a, 0000 0000 b5 ld hl, SPRATR6 call SetVdp_Write7 ld hl, SPRATR_Buffer8 ld c, PORT_09 outi outi outi outi10 outi outi outi outi 12 retMain.s28 UpdateSPRATR_Buffer.s1UpdateSPRATR_Buffer:2 3 4 5 ld hl, SPRATR_Buffer7 8 ld a, (Player.Y + 1) 9 srl a 10 srl a11 add 12812 ld (hl), a14 inc hl15 16 ld a, (Player.X + 1) 17 srl a 18 srl a19 ld (hl), a23 24 ld hl, SPRATR_Buffer + 426 27 ld a, (Object_0 + 3) 28 srl a 29 srl a30 add 12831 ld (hl), a33 inc hl34 35 ld a, (Object_0 + 1) 36 srl a 37 srl a38 ld (hl), a43 retMain.s29 30 UnitTests/UnitTests.s1UnitTests:3.Run:4 5 ld a, 15 6 ld (BIOS_FORCLR), a 7 ld a, 1 8 ld (BIOS_BAKCLR), a 9 ld a, 1 10 ld (BIOS_BDRCLR), a 11 call BIOS_CHGCLR 13 call BIOS_INITXT 16 19 call PlayerLogic_Tests21 22 ld b, 18023 call Wait_B_Vblanks25 ret283032.check_HL_equals_0:33 ld de, 034 call BIOS_DCOMPR35 jp nz, .testFailed36 jp .testPassed38.check_HL_equals_DE:39 call BIOS_DCOMPR40 jp nz, .testFailed41 jp .testPassed4345.testPassed:46 ld hl, TEST_PASSED_STRING47 call PrintString_CrLf48 ret50.testFailed:52 ld a, 8 53 ld (BIOS_BAKCLR), a 54 ld a, 8 55 ld (BIOS_BDRCLR), a 56 call BIOS_CHGCLR 58 ld hl, TEST_FAILED_STRING59 call PrintString_CrLf60 ret6264TEST_PASSED_STRING: db 'Test passed', 065TEST_FAILED_STRING: db 'TEST FAILED !', 066Main.s31 UnitTests/PlayerLogic_Tests.s1PlayerLogic_Tests:3 call .Test_angle_04 6 ret810.Test_angle_0:11 12 call PlayerInit16 17 ld hl, (Player.angle)18 call UnitTests.check_HL_equals_020 ld hl, (Player.FoV_start)21 ld de, 360-3222 call UnitTests.check_HL_equals_DE24 ld hl, (Player.FoV_end)25 ld de, 3226 call UnitTests.check_HL_equals_DE28 ret3031Main.s3435NAMTBL: equ 0x1800 36PATTBL: equ 0x0000 37COLTBL: equ 0x2000 38SPRPAT: equ 0x3800 39SPRCOL: equ 0x1c00 40SPRATR: equ 0x1e00 42Execute:43 44 di 45 im 1 46 ld sp, (BIOS_HIMEM) 49 ld hl, RamStart 50 ld de, RamEnd + 1 51 call ClearRam_WithParameters5355 IFDEF DEBUG56 call UnitTests.Run57 ENDIF5962 call BIOS_DISSCR67 68 xor a69 ld (BIOS_CLIKSW), a 73 call EnableRomPage275 76 ld a, 177 ld (Seg_P8000_SW), a79 80 ld a, 1 81 ld (BIOS_FORCLR), a 82 ld a, 1 83 ld (BIOS_BAKCLR), a 84 ld a, 1 85 ld (BIOS_BDRCLR), a 86 call BIOS_CHGCLR 88 89 ld a, 490 call BIOS_CHGMOD92 call ClearVram_MSX294 call Set192Lines96 call SetColor0ToNonTransparent98 99 ld hl, NAMTBL_Data 100 ld de, NAMTBL + (32*16) 101 ld bc, NAMTBL_Data.size 102 call BIOS_LDIRVM 104 105 ld hl, PATTBL_Data 106 ld de, PATTBL + (32*16*8) 107 ld bc, PATTBL_Data.size 108 call BIOS_LDIRVM 110 111 ld hl, COLTBL_Data 112 ld de, COLTBL + (32*16*8) 113 ld bc, COLTBL_Data.size 114 call BIOS_LDIRVM 116 117 ld hl, SPRPAT_Data 118 ld de, SPRPAT 119 ld bc, SPRPAT_Data.size 120 call BIOS_LDIRVM 122 123 ld hl, SPRCOL_Data 124 ld de, SPRCOL 125 ld bc, SPRCOL_Data.size 126 call BIOS_LDIRVM 128 129 ld hl, SPRATR_Data 130 ld de, SPRATR_Buffer 131 ld bc, SPRATR_Data.size 132 ldir 135 call BIOS_ENASCR137139 140 call PlayerInit143 ld hl, 32768 + 16384144 ld (Object_0), hl 145 ld hl, 32768 - 16384146 ld (Object_0 + 2), hl 147 ld hl, 0148 ld (Object_0 + 4), hl 149 ld (Object_0 + 6), hl 150 ld (Object_0 + 8), hl 151 xor a152 ld (Object_0 + 10), a 155157159.mainLoop:161 call Wait_Vblank165 IFDEF DEBUG166 ld a, 4 167 ld (BIOS_BDRCLR), a168 call BIOS_CHGCLR 169 ENDIF171 call UpdateSPRATR173 175 IFDEF DEBUG176 ld a, 7 177 ld (BIOS_BDRCLR), a178 call BIOS_CHGCLR 179 ENDIF180 181 call ReadInput183 185 IFDEF DEBUG186 ld a, 8 187 ld (BIOS_BDRCLR), a188 call BIOS_CHGCLR 189 ENDIF190 191 ld hl, Object_0192 call ObjectLogic194 196 IFDEF DEBUG197 ld a, 12 198 ld (BIOS_BDRCLR), a199 call BIOS_CHGCLR 200 ENDIF202 call UpdateSPRATR_Buffer204 206 IFDEF DEBUG207 ld a, 1 208 ld (BIOS_BDRCLR), a209 call BIOS_CHGCLR 210 ENDIF214 jp .mainLoop217End:219223NAMTBL_Data:224 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0225 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0226 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0227 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0228 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0229 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0230 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0231 db 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0232.size: equ $ - NAMTBL_Data234PATTBL_Data:235 db 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00236 db 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff237.size: equ $ - PATTBL_Data239COLTBL_Data:240 db 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x11241 db 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff, 0xff242.size: equ $ - COLTBL_Data244SPRPAT_Data:245 db 11000000 b246 db 11000000 b247 db 00000000 b248 db 00000000 b249 db 00000000 b250 db 00000000 b251 db 00000000 b252 db 00000000 b253.size: equ $ - SPRPAT_Data255SPRCOL_Data:256 db 0x08, 0x08, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0257 db 0x04, 0x04, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0258.size: equ $ - SPRCOL_Data260SPRATR_Data:261 262 db 0, 0, 0, 0263 db 0, 0, 0, 0264.size: equ $ - SPRATR_Data266 267269 db "End ROM started at 0x4000"271 ds PageSize - ($ - 0x4000), 255 274284286287 org 0xc000, 0xe5ff289RamStart:291 Variables.s1SavedJiffy: rb 13SPRATR_Buffer: rb 128 5Player:6.X: rw 1 7.Y: rw 1 8.angle: rw 1 9.FoV_start: rw 1 10.FoV_end: rw 1 11.walk_DX: rw 1 12.walk_DY: rw 1 16 org 0xc10018Object_0: rb Object_Temp.size20Object_Temp:21.X: rw 1 22.Y: rw 1 23.distance_X: rw 1 24.distance_Y: rw 1 25.angleToPlayer: rw 1 26.isVisible: rb 1 27.size: equ $ - Object_Temp29ObjectAddress: rw 130Main.s293RamEnd: